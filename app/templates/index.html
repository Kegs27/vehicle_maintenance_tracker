<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Maintenance Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 4rem 0;
        }
        
        /* Background styling */
        body {
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><pattern id="tools" patternUnits="userSpaceOnUse" width="200" height="200"><g fill="%23f8f9fa" opacity="0.1"><path d="M20 20h40v40h-40z"/><circle cx="40" cy="40" r="15"/><path d="M60 30h20v20h-20z"/><path d="M90 35h10v10h-10z"/><path d="M110 25h15v30h-15z"/><path d="M135 30h20v20h-20z"/><path d="M160 35h15v10h-15z"/><path d="M180 25h20v30h-20z"/><path d="M25 70h30v20h-30z"/><path d="M65 75h25v10h-25z"/><path d="M100 70h20v20h-20z"/><path d="M130 75h25v10h-25z"/><path d="M165 70h20v20h-20z"/><path d="M30 100h40v30h-40z"/><path d="M80 105h30v20h-30z"/><path d="M120 100h40v30h-40z"/><path d="M170 105h30v20h-30z"/><path d="M40 140h20v20h-20z"/><path d="M70 140h20v20h-20z"/><path d="M100 140h20v20h-20z"/><path d="M130 140h20v20h-20z"/><path d="M160 140h20v20h-20z"/><path d="M50 170h10v10h-10z"/><path d="M80 170h10v10h-10z"/><path d="M110 170h10v10h-10z"/><path d="M140 170h10v10h-10z"/><path d="M170 170h10v10h-10z"/></g></pattern><pattern id="vehicles" patternUnits="userSpaceOnUse" width="300" height="200"><g fill="%23e9ecef" opacity="0.08"><path d="M50 50h200v100h-200z"/><path d="M70 70h160v60h-160z"/><path d="M80 80h140v40h-140z"/><path d="M90 90h120v20h-120z"/><path d="M100 100h100v10h-100z"/><path d="M110 110h80v5h-80z"/><path d="M120 120h60v3h-60z"/><path d="M130 130h40v2h-40z"/><path d="M140 140h20v1h-20z"/><path d="M150 150h10v0.5h-10z"/><path d="M160 160h5v0.25h-5z"/><path d="M170 170h2.5v0.125h-2.5z"/><path d="M180 180h1.25v0.0625h-1.25z"/><path d="M190 190h0.625v0.03125h-0.625z"/><path d="M200 200h0.3125v0.015625h-0.3125z"/><path d="M210 210h0.15625v0.0078125h-0.15625z"/><path d="M220 220h0.078125v0.00390625h-0.078125z"/><path d="M230 230h0.0390625v0.001953125h-0.0390625z"/><path d="M240 240h0.01953125v0.0009765625h-0.01953125z"/><path d="M250 250h0.009765625v0.00048828125h-0.009765625z"/><path d="M260 260h0.0048828125v0.000244140625h-0.0048828125z"/><path d="M270 270h0.00244140625v0.0001220703125h-0.00244140625z"/><path d="M280 280h0.001220703125v0.00006103515625h-0.001220703125z"/><path d="M290 290h0.0006103515625v0.000030517578125h-0.0006103515625z"/><path d="M300 300h0.00030517578125v0.0000152587890625h-0.00030517578125z"/></g></pattern></defs><rect width="1200" height="800" fill="%23ffffff"/><rect width="1200" height="800" fill="url(%23tools)"/><rect width="1200" height="800" fill="url(%23vehicles)"/></svg>');
            background-attachment: fixed;
            background-size: cover;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
            z-index: -1;
        }
        
        /* Content styling to stand out against background */
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.1);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.1);
        }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.9) 0%, rgba(124, 58, 237, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);
        }
        .feature-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .feature-card {
            transition: all 0.3s ease;
        }
        
        .feature-card:hover .badge {
            background-color: #6f42c1 !important;
        }
        .nav-link {
            color: #6c757d;
            font-weight: 500;
        }
        .nav-link:hover {
            color: #6f42c1;
        }
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Consistent button styling */
        .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-outline-light {
            border: 2px solid white;
            color: white;
        }
        
        .btn-outline-light:hover {
            background: white;
            color: #6c757d;
        }
        
        .btn-success {
            background: #10b981;
            border: 2px solid #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-car me-2"></i>Vehicle Maintenance Tracker
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/vehicles">Vehicles</a>
                <a class="nav-link" href="/maintenance">Maintenance</a>
                <a class="nav-link" href="#" onclick="showTransferOptions(); return false;">Transfer Data</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-white text-center py-5">
        <div class="container">
            <h1 class="display-4 mb-4">
                <i class="fas fa-wrench me-3"></i>Vehicle Maintenance Tracker
            </h1>
            <p class="lead mb-4">Keep track of your vehicle maintenance, oil changes, and service history in one place.</p>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="/maintenance/new" class="btn btn-outline-light btn-lg">
                    <i class="fas fa-tools me-2"></i>Add Maintenance Record
                </a>
                <div class="dropdown d-inline-block">
                    <button class="btn btn-outline-light btn-lg dropdown-toggle" type="button" id="heroTransferDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-exchange-alt me-2"></i>Transfer Data
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="heroTransferDropdown">
                        <li><a class="dropdown-item" href="/import">
                            <i class="fas fa-upload me-2 text-primary"></i>Import Data
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportToCSV()">
                            <i class="fas fa-file-csv me-2 text-success"></i>Transfer All to CSV
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf me-2 text-danger"></i>Transfer All to PDF
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="exportSingleVehicle()">
                            <i class="fas fa-car me-2 text-primary"></i>Transfer Single Vehicle
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-5">
        <div class="container">
            <h3 class="text-center mb-5">Features</h3>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center">
                        <div class="card-body p-4">
                            <i class="fas fa-car fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Vehicle Management</h5>
                            <p class="card-text">Add and manage multiple vehicles with detailed information including VIN, year, make, and model.</p>
                            <a href="/vehicles" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>Manage Vehicles
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center">
                        <div class="card-body p-4">
                            <i class="fas fa-tools fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Maintenance Tracking</h5>
                            <p class="card-text">Record and track all maintenance activities with dates, mileage, descriptions, and costs.</p>
                            <a href="/maintenance" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>View Records
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center">
                        <div class="card-body p-4">
                            <i class="fas fa-exchange-alt fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Data Transfer</h5>
                            <p class="card-text">Import maintenance records from CSV files and transfer data to various formats.</p>
                            <button class="btn btn-outline-primary" onclick="showTransferOptions()">
                                <i class="fas fa-exchange-alt me-2"></i>Transfer Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="py-5 bg-light">
        <div class="container">
            <h3 class="text-center mb-4">Quick Actions</h3>
            <div class="row g-3 justify-content-center">
                <div class="col-auto">
                    <a href="/vehicles" class="btn btn-primary">
                        <i class="fas fa-list me-2"></i>View Vehicles
                    </a>
                </div>
                <div class="col-auto">
                    <a href="/maintenance" class="btn btn-primary">
                        <i class="fas fa-tools me-2"></i>View Records
                    </a>
                </div>
                <div class="col-auto">
                    <a href="/maintenance/new" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Add Record
                    </a>
                </div>

            </div>
        </div>
    </section>

    <!-- Resources Section -->
    <section class="py-5">
        <div class="container">
            <h3 class="text-center mb-4">Professional Resources</h3>
            <div class="row justify-content-center g-4">
                <div class="col-md-6">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-book fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">ALLDATA DIY</h5>
                            <p class="card-text">Access factory service manuals, repair procedures, and technical service bulletins for over 30,000 vehicles.</p>
                            <div class="mt-3">
                                <a href="https://www.alldata.com/diy-us/en" target="_blank" class="btn btn-outline-primary">
                                    <i class="fas fa-external-link-alt me-2"></i>Visit ALLDATA DIY
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-shopping-cart fa-3x text-warning mb-3"></i>
                            <h5 class="card-title">AutoZone</h5>
                            <p class="card-text">Find auto parts, tools, and accessories with in-store pickup and professional advice.</p>
                            <div class="mt-3">
                                <a href="https://www.autozone.com" target="_blank" class="btn btn-outline-warning">
                                    <i class="fas fa-external-link-alt me-2"></i>Visit AutoZone
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-tools fa-3x text-danger mb-3"></i>
                            <h5 class="card-title">Advanced Auto</h5>
                            <p class="card-text">Quality auto parts, tools, and expert advice for DIY mechanics and professionals.</p>
                            <div class="mt-3">
                                <a href="https://www.advanceautoparts.com" target="_blank" class="btn btn-outline-danger">
                                    <i class="fas fa-external-link-alt me-2"></i>Visit Advanced Auto
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-truck fa-3x text-info mb-3"></i>
                            <h5 class="card-title">RockAuto</h5>
                            <p class="card-text">Discounted auto parts with fast shipping and extensive catalog for all vehicle makes and models.</p>
                            <div class="mt-3">
                                <a href="https://www.rockauto.com" target="_blank" class="btn btn-outline-info">
                                    <i class="fas fa-external-link-alt me-2"></i>Visit RockAuto
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        function showTransferOptions() {
            // Create a modal or use Bootstrap's built-in modal
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'transferModal';
            modal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-exchange-alt me-2"></i>Transfer Data
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="card h-100 border-primary">
                                        <div class="card-body text-center p-4">
                                            <i class="fas fa-upload fa-3x text-primary mb-3"></i>
                                            <h6 class="card-title">Import Data</h6>
                                            <p class="card-text small">Import maintenance records from Google Sheets CSV files.</p>
                                            <a href="/import" class="btn btn-primary btn-sm">
                                                <i class="fas fa-upload me-2"></i>Import CSV
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                                                                <div class="card h-100 border-success">
                                                <div class="card-body text-center p-4">
                                                    <i class="fas fa-download fa-3x text-success mb-3"></i>
                                                    <h6 class="card-title">Transfer Data Out</h6>
                                                    <p class="card-text small">Transfer your data to CSV or create PDF reports.</p>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-success btn-sm" onclick="exportToCSV(); $('#transferModal').modal('hide');">
                                                            <i class="fas fa-file-csv me-2"></i>Transfer All to CSV
                                                        </button>
                                                        <button class="btn btn-danger btn-sm" onclick="exportToPDF(); $('#transferModal').modal('hide');">
                                                            <i class="fas fa-file-pdf me-2"></i>Transfer All to PDF
                                                        </button>
                                                        <button class="btn btn-primary btn-sm" onclick="exportSingleVehicle(); $('#transferModal').modal('hide');">
                                                            <i class="fas fa-car me-2"></i>Transfer Single Vehicle
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show the modal
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            
            // Remove modal from DOM after it's hidden
            modal.addEventListener('hidden.bs.modal', function () {
                document.body.removeChild(modal);
            });
        }
        
        function exportToCSV() {
            // Get all vehicles and their maintenance records
            const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
            let csvContent = 'Vehicle Name,Year,Make,Model,VIN,Maintenance Date,Mileage,Description,Cost\n';
            
            vehicles.forEach(vehicle => {
                const maintenanceRecords = JSON.parse(localStorage.getItem(`maintenanceRecords_${vehicle.id}`) || '[]');
                const oilChangeRecords = JSON.parse(localStorage.getItem(`oilChangeHistory_${vehicle.id}`) || '[]');
                
                // Add maintenance records
                maintenanceRecords.forEach(record => {
                    csvContent += `"${vehicle.name}",${vehicle.year},${vehicle.make},${vehicle.model},"${vehicle.vin || ''}","${record.date || ''}",${record.mileage || ''},"${record.description || ''}",${record.cost || ''}\n`;
                });
                
                // Add oil change records
                oilChangeRecords.forEach(record => {
                    csvContent += `"${vehicle.name}",${vehicle.year},${vehicle.make},${vehicle.model},"${vehicle.vin || ''}","${record.date || ''}",${record.mileage || ''},"Oil Change - ${record.oilUsed || 'Oil not specified'}, Filter: ${record.filterUsed || 'Not specified'}",\n`;
                });
            });
            
            // Create and download CSV file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `vehicle_maintenance_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToPDF() {
            // Get all vehicles and their data
            const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
            
            // Create PDF content using jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPosition = 20;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            
            // Add title
            doc.setFontSize(20);
            doc.text('Vehicle Maintenance Report', margin, yPosition);
            yPosition += 20;
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, margin, yPosition);
            yPosition += 15;
            
            vehicles.forEach((vehicle, vehicleIndex) => {
                // Check if we need a new page
                if (yPosition > pageHeight - 40) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Vehicle header
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(`${vehicle.name} (${vehicle.year} ${vehicle.make} ${vehicle.model})`, margin, yPosition);
                yPosition += 10;
                
                // Vehicle details
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`VIN: ${vehicle.vin || 'Not specified'}`, margin, yPosition);
                yPosition += 8;
                
                // Get maintenance records
                const maintenanceRecords = JSON.parse(localStorage.getItem(`maintenanceRecords_${vehicle.id}`) || '[]');
                const oilChangeRecords = JSON.parse(localStorage.getItem(`oilChangeHistory_${vehicle.id}`) || '[]');
                
                if (maintenanceRecords.length > 0 || oilChangeRecords.length > 0) {
                    doc.text('Maintenance Records:', margin, yPosition);
                    yPosition += 8;
                    
                    // Add maintenance records
                    maintenanceRecords.forEach(record => {
                        if (yPosition > pageHeight - 40) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        // Split description into multiple lines if it's too long
                        const description = record.description || 'No description';
                        const maxLineLength = 60; // Characters per line
                        const lines = [];
                        
                        if (description.length > maxLineLength) {
                            // Split long descriptions into multiple lines
                            for (let i = 0; i < description.length; i += maxLineLength) {
                                lines.push(description.slice(i, i + maxLineLength));
                            }
                        } else {
                            lines.push(description);
                        }
                        
                        // Add the main record line
                        doc.text(`• ${record.date || 'No date'} - ${record.mileage || 'No mileage'} miles:`, margin + 5, yPosition);
                        yPosition += 6;
                        
                        // Add description lines with proper indentation
                        lines.forEach(line => {
                            if (yPosition > pageHeight - 30) {
                                doc.addPage();
                                yPosition = 20;
                            }
                            doc.text(`  ${line}`, margin + 10, yPosition);
                            yPosition += 6;
                        });
                        
                        // Add extra spacing after each record
                        yPosition += 2;
                    });
                    
                    // Add oil change records
                    oilChangeRecords.forEach(record => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        doc.text(`• ${record.date || 'No date'} - ${record.mileage || 'No mileage'} miles: Oil Change - ${record.oilUsed || 'Oil not specified'}`, margin + 5, yPosition);
                        yPosition += 6;
                    });
                } else {
                    doc.text('No maintenance records found.', margin, yPosition);
                    yPosition += 8;
                }
                
                yPosition += 10;
            });
            
            // Save PDF
            doc.save(`vehicle_maintenance_${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        function exportSingleVehicle() {
            // Redirect to vehicles page for single vehicle export
            window.location.href = '/vehicles';
        }
    </script>
</body>
</html>
